{"version":3,"sources":["Map.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["\r\nconst {ccclass, property} = cc._decorator;\r\nimport { Picitem } from './Picitem';\r\nimport { Algorithm } from './Algorithm';\r\nimport { Game } from './Game';\r\n\r\n\r\n@ccclass\r\nexport class Map extends cc.Component {\r\n\r\n    @property(Game)\r\n    game: Game = null;\r\n    @property(cc.Prefab)\r\n    public pic: cc.Prefab = null;//图片预置资源\r\n    @property(cc.SpriteFrame)\r\n    private pics: cc.SpriteFrame[] = new Array();\r\n    @property\r\n    private readonly picCount: number = 8;//图片个数（与pics数组的length一致）\r\n    \r\n    private readonly length: number = 60;//单元格长度\r\n    private rows: number = 0;//行\r\n    private colmns: number = 0;//列\r\n    public mapArray: number[][];//地图二维数组\r\n    public static twoPics: Picitem[] = []//存取两个被点击的图片\r\n    \r\n    start () {  \r\n        this.initMapArray();    \r\n        this.addPicItems();\r\n    }\r\n    update (dt) {\r\n         if(Map.twoPics.length > 1){\r\n            if(Algorithm.canBeRemoved(Map.twoPics[0].pos, Map.twoPics[1].pos, this.mapArray)){               \r\n                this.removePicNodes(Map.twoPics);           \r\n                this.game.getScore();\r\n            }else{\r\n                this.goBackPicsStyle(Map.twoPics);\r\n            }\r\n            Map.twoPics = [];\r\n         }\r\n         if(this.node.children.length < 2){\r\n            this.game.gameOver();\r\n         }      \r\n     }\r\n    /**\r\n     * @description: 初始化二维数组\r\n     * @param {type} \r\n     * @return: \r\n     */\r\n    private initMapArray (){\r\n        this.rows = Math.floor(this.node.width / this.length);\r\n        this.colmns = Math.floor(this.node.height / this.length);\r\n        this.mapArray = [];\r\n        for(let i=0; i<this.rows; ++i){\r\n            this.mapArray[i] = Array(this.colmns);\r\n            for(let j=0; j<this.colmns; ++j){\r\n                this.mapArray[i][j] = 0;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * @description: 在本节点添加多张图片精灵\r\n     * @param {type} \r\n     * @return: \r\n     */\r\n    private addPicItems () {\r\n        let randomList = this.getDoubleRandomList();\r\n        for(let i=1; i<this.rows-1; ++i){\r\n            for(let j=1; j<this.colmns-1; ++j){\r\n                //实例化预制资源图\r\n                let picitem = cc.instantiate(this.pic);\r\n                //添加到地图\r\n                this.node.addChild(picitem);\r\n                //设置每个实例的位置\r\n                picitem.setPosition(i*this.length+this.length/2, -j*this.length-this.length/2);\r\n                //得到随机数组里的值\r\n                const temp = randomList[(i-1)*(this.colmns-2) + (j-1)];\r\n                //初始化每个图片的位置、名字信息\r\n                picitem.getComponent(Picitem).pos = cc.v2(i,j);\r\n                picitem.getComponent(Picitem).picId = temp;\r\n                //随机填充图片\r\n                picitem.getComponent(cc.Sprite).spriteFrame = this.pics[temp-1];\r\n                this.mapArray[i][j] = temp;\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * @description: 得到每个数字都有偶数个的一维数组\r\n     * @param {type} \r\n     * @return: 随机且每项数目为偶数的数组\r\n     */\r\n    private getDoubleRandomList (){\r\n        //保证生成的每个数字都有偶数个\r\n        let randomList: number[] = new Array();\r\n        for(let i=(this.rows-2)*(this.colmns-2)/2-1; i>=0; --i){\r\n            let randomNum = Math.floor(Math.random()*this.picCount+1);// 1~8\r\n            randomList.push(randomNum);\r\n            randomList.push(randomNum);\r\n        }\r\n        //对数组随机排序\r\n        randomList.sort(()=> Math.random()>0.5 ? -1 : 1);\r\n        return randomList;\r\n    } \r\n    /**\r\n     * @description: 消除多张图片 \r\n     * @param {Picitem[]} 图片数组 \r\n     * @return: 无\r\n     */\r\n    private removePicNodes(pics: Picitem[]){\r\n        pics.forEach((item)=>{\r\n            item.isRemoved = true;\r\n            item.removePic();\r\n            this.mapArray[item.pos.x][item.pos.y] = 0; \r\n        })\r\n    }\r\n    /**\r\n     * @description: 还原多张图的样式\r\n     * @param {Picitem[]} 图片数组 \r\n     * @return: 无\r\n     */\r\n    private goBackPicsStyle (pics: Picitem[]){\r\n        pics.forEach((item)=>{item.isSelected = false; item.changeStyle();});\r\n    }\r\n    /**\r\n     * @description: 遍历多维数组，判断是否所有值都为0\r\n     * @param {type} 无\r\n     * @return: true/false\r\n     */    \r\n    private allValueIsZero (){\r\n      return (this.mapArray+'').split(',').every((item)=>{return item==='0'});\r\n    }\r\n}\r\n"]}